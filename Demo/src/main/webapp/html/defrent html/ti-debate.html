<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>因明辩经智慧平台</title>
    <style>
        :root {
            --tibetan-red: #9D2933;
            --tibetan-gold: #DAA520;
            --tibetan-blue: #4682B4;
            --tibetan-cream: #F5F5DC;
            --debate-green: #4CAF50;
            --debate-red: #F44336;
            --shadow-light: 0 2px 8px rgba(0,0,0,0.1);
            --rounded-md: 8px;
        }

        body {
            font-family: 'Noto Sans Tibetan', 'Microsoft YaHei', sans-serif;
            background-color: var(--tibetan-cream);
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* 顶部导航 */
        .header {
            background: linear-gradient(135deg, var(--tibetan-red), var(--tibetan-blue));
            color: white;
            padding: 15px 20px;
            box-shadow: var(--shadow-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-weight: 500;
            font-size: 20px;
        }

        /* 主布局 */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            min-height: calc(100vh - 55px);
            gap: 20px;
            padding: 20px;
        }

        /* 辩论区 */
        .debate-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .debate-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .debate-btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--rounded-md);
            background: var(--tibetan-blue);
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .debate-btn.ai {
            background: var(--debate-green);
        }

        .debate-btn.human {
            background: var(--tibetan-gold);
        }

        .debate-btn.reset {
            background: var(--debate-red);
        }

        .message-area {
            flex-grow: 1;
            background: white;
            border-radius: var(--rounded-md);
            padding: 15px;
            overflow-y: auto;
            box-shadow: var(--shadow-light);
            max-height: 400px;
        }

        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: var(--rounded-md);
            max-width: 80%;
            font-size: 26px; /* 设置字体大小为 26px */
        }

        .user-message {
            background: var(--tibetan-blue);
            color: white;
            margin-left: auto;
        }

        .opponent-message {
            background: var(--tibetan-cream);
            border: 1px solid var(--tibetan-blue);
            margin-right: auto;
        }

        .input-area {
            display: flex;
            gap: 10px;
        }

        .input-area input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--tibetan-blue);
            border-radius: var(--rounded-md);
            font-size: 28px; /* 修改字体大小为 28px */
        }

        .input-area button {
            padding: 10px 15px;
            background: var(--tibetan-red);
            color: white;
            border: none;
            border-radius: var(--rounded-md);
            cursor: pointer;
        }

        /* 可视化区 */
        .visualization-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .logic-tree {
            background: white;
            border-radius: var(--rounded-md);
            padding: 15px;
            box-shadow: var(--shadow-light);
            height: 300px;
            position: relative;
            overflow: hidden;
        }

        .heatmap {
            background: white;
            border-radius: var(--rounded-md);
            padding: 15px;
            box-shadow: var(--shadow-light);
            height: 200px;
            position: relative;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 顶部导航 -->
    <div class="header">
        <h1>因明辩经智慧平台</h1>
        <div>藏传佛教逻辑辩论系统</div>
    </div>

    <!-- 主布局 -->
    <div class="main-container">
        <!-- 辩论区 -->
        <div class="debate-area">
            <div class="debate-controls">
                <button class="debate-btn ai">与AI辩论</button>
                <button class="debate-btn human">与真人辩论</button>
                <button class="debate-btn reset">重置辩论</button>
            </div>

            <div class="message-area" id="messageArea">
                <div class="message opponent-message">
                    欢迎来到因明辩经平台！我是您的辩论助手，让我们开始一场逻辑严谨的辩论吧。
                </div>
            </div>

            <div class="input-area">
                <input type="text" id="debateInput" placeholder="输入您的论点...">
                <button id="sendBtn">发送</button>
            </div>
        </div>

        <!-- 可视化区 -->
        <div class="visualization-area">
            <div class="logic-tree">
                <h3>逻辑树可视化</h3>
                <canvas id="logicTree" width="280" height="280"></canvas>
            </div>

            <div class="heatmap">
                <h3>逻辑复杂度热力图</h3>
                <canvas id="heatmap" width="280" height="150"></canvas>
            </div>
        </div>
    </div>

    <script>
        // 辩论逻辑
        const debateLogic = {
            currentDebate: null,
            debateHistory: [],
            logicTree: {
                nodes: [],
                edges: []
            },
            complexityMap: {}
        };

        // DOM元素
        const messageArea = document.getElementById('messageArea');
        const debateInput = document.getElementById('debateInput');
        const sendBtn = document.getElementById('sendBtn');
        const logicTreeCanvas = document.getElementById('logicTree');
        const heatmapCanvas = document.getElementById('heatmap');

        // 初始化画布
        const logicTreeCtx = logicTreeCanvas.getContext('2d');
        const heatmapCtx = heatmapCanvas.getContext('2d');

        // 绘制初始逻辑树
        drawInitialLogicTree();

        // 事件监听
        sendBtn.addEventListener('click', sendMessage);
        debateInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        document.querySelector('.debate-btn.ai').addEventListener('click', startAIDebate);
        document.querySelector('.debate-btn.human').addEventListener('click', startHumanDebate);
        document.querySelector('.debate-btn.reset').addEventListener('click', resetDebate);

        // 函数定义
        function sendMessage() {
            const message = debateInput.value.trim();
            if (message === '') return;

            // 添加用户消息
            addMessage(message, 'user');
            debateInput.value = '';

            // 模拟AI回复
            if (debateLogic.currentDebate === 'ai') {
                setTimeout(() => {
                    const aiResponse = generateAIResponse(message);
                    addMessage(aiResponse.text, 'ai');
                    updateLogicTree(aiResponse.logicNode);
                    updateHeatmap(aiResponse.complexity);
                }, 1000);
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'opponent-message');
            messageDiv.textContent = text;
            messageArea.appendChild(messageDiv);
            messageArea.scrollTop = messageArea.scrollHeight;

            // 记录辩论历史
            debateLogic.debateHistory.push({
                text,
                sender,
                timestamp: new Date()
            });
        }

        function startAIDebate() {
            debateLogic.currentDebate = 'ai';
            messageArea.innerHTML = '<div class="message opponent-message">已启动AI辩论模式，请提出您的第一个论点。</div>';
            debateLogic.debateHistory = [];
            resetLogicTree();
        }

        function startHumanDebate() {
            debateLogic.currentDebate = 'human';
            messageArea.innerHTML = '<div class="message opponent-message">已准备真人辩论，等待对手连接...</div>';
            debateLogic.debateHistory = [];
            resetLogicTree();
            // 这里可以添加WebSocket连接逻辑
        }

        function resetDebate() {
            debateLogic.currentDebate = null;
            messageArea.innerHTML = '<div class="message opponent-message">辩论已重置，请选择辩论模式。</div>';
            debateLogic.debateHistory = [];
            resetLogicTree();
            resetHeatmap();
        }

        function generateAIResponse(message) {
            // 简化的AI响应逻辑
            const responses = [
                {
                    text: "您提出了一个有趣的观点。根据因明学，这个论点是否考虑了所有可能性？",
                    logicNode: { id: 'n1', text: '考虑所有可能性', type: 'question' },
                    complexity: 0.6
                },
                {
                    text: "这个论点似乎隐含了一个假设，您能否明确说明这个假设是什么？",
                    logicNode: { id: 'n2', text: '隐含假设', type: 'challenge' },
                    complexity: 0.7
                },
                {
                    text: "在藏传因明学中，我们通常会问：这个结论是否必然从前提中得出？",
                    logicNode: { id: 'n3', text: '必然性检验', type: 'method' },
                    complexity: 0.8
                }
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function drawInitialLogicTree() {
            logicTreeCtx.clearRect(0, 0, logicTreeCanvas.width, logicTreeCanvas.height);
            logicTreeCtx.font = '12px Arial';
            const tibetanBlue = '#4682B4'; // 定义具体颜色值
            logicTreeCtx.fillStyle = tibetanBlue;
            logicTreeCtx.fillText('辩论逻辑树将在此显示', 50, 50);
        }

        function updateLogicTree(node) {
            // 简化的逻辑树更新
            debateLogic.logicTree.nodes.push(node);
            
            if (debateLogic.logicTree.nodes.length > 1) {
                debateLogic.logicTree.edges.push({
                    from: debateLogic.logicTree.nodes[debateLogic.logicTree.nodes.length-2].id,
                    to: node.id
                });
            }
            
            // 重新绘制逻辑树
            drawLogicTree();
        }

        function drawLogicTree() {
            logicTreeCtx.clearRect(0, 0, logicTreeCanvas.width, logicTreeCanvas.height);
            
            const tibetanBlue = '#4682B4'; // 定义具体颜色值
            
            // 绘制节点
            debateLogic.logicTree.nodes.forEach((node, index) => {
                const x = 50 + index * 80;
                const y = 50 + (index % 2) * 60;
                
                // 绘制连接线
                if (index > 0) {
                    logicTreeCtx.beginPath();
                    logicTreeCtx.moveTo(x - 60, y - (index % 2) * 30);
                    logicTreeCtx.lineTo(x - 20, y);
                    logicTreeCtx.strokeStyle = tibetanBlue;
                    logicTreeCtx.stroke();
                }
                
                // 绘制节点
                logicTreeCtx.beginPath();
                logicTreeCtx.arc(x, y, 20, 0, Math.PI * 2);
                const debateGreen = '#4CAF50';
                const debateRed = '#F44336';
                const tibetanGold = '#DAA520';
                logicTreeCtx.fillStyle = node.type === 'question' ? debateGreen :
                                             node.type === 'challenge' ? debateRed : tibetanGold;
                logicTreeCtx.fill();
                
                // 绘制节点文本
                logicTreeCtx.fillStyle = 'white';
                logicTreeCtx.font = '10px Arial';
                logicTreeCtx.textAlign = 'center';
                logicTreeCtx.fillText(node.id, x, y + 5);
                
                // 绘制节点标签
                logicTreeCtx.fillStyle = 'black';
                logicTreeCtx.font = '8px Arial';
                logicTreeCtx.fillText(node.text.substring(0, 10) + '...', x, y + 30);
            });
        }

        function resetLogicTree() {
            debateLogic.logicTree = { nodes: [], edges: [] };
            drawInitialLogicTree();
        }

        function updateHeatmap(complexity) {
            // 简化的热力图更新
            const timestamp = new Date().toLocaleTimeString();
            debateLogic.complexityMap[timestamp] = complexity;
            
            // 重新绘制热力图
            drawHeatmap();
        }

        function drawHeatmap() {
            heatmapCtx.clearRect(0, 0, heatmapCanvas.width, heatmapCanvas.height);
            
            const timestamps = Object.keys(debateLogic.complexityMap);
            if (timestamps.length === 0) return;
            
            const cellWidth = heatmapCanvas.width / timestamps.length;
            
            timestamps.forEach((ts, index) => {
                const complexity = debateLogic.complexityMap[ts];
                const hue = 120 - (complexity * 120); // 从绿到红
                
                heatmapCtx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                heatmapCtx.fillRect(index * cellWidth, 0, cellWidth, heatmapCanvas.height);
                
                // 显示时间标签
                if (index % 2 === 0) {
                    heatmapCtx.fillStyle = 'black';
                    heatmapCtx.font = '6px Arial';
                    heatmapCtx.fillText(ts.split(':')[1], index * cellWidth + 2, 10);
                }
            });
            
            // 添加图例
            heatmapCtx.fillStyle = 'black';
            heatmapCtx.font = '8px Arial';
            heatmapCtx.fillText('逻辑复杂度', 5, heatmapCanvas.height - 5);
        }

        function resetHeatmap() {
            debateLogic.complexityMap = {};
            heatmapCtx.clearRect(0, 0, heatmapCanvas.width, heatmapCanvas.height);
            heatmapCtx.fillStyle = 'black';
            heatmapCtx.font = '12px Arial';
            heatmapCtx.fillText('逻辑热力图将在此显示', 50, 50);
        }
    </script>
</body>
</html>
